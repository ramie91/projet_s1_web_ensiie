{{ define "base" -}}
<!doctype html>
<html lang="fr">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link rel="stylesheet" href="/static/css/output.css">
  <title>{{ .title }}</title>
  <script>
    // Pré-application du thème/langue avant le rendu pour éviter un flash de style/texte.
    try {
      const storedTheme = localStorage.getItem("app-theme");
      const prefersDark = window.matchMedia && window.matchMedia("(prefers-color-scheme: dark)").matches;
      const initialTheme = storedTheme || (prefersDark ? "dark" : "light");
      document.documentElement.classList.toggle("dark", initialTheme === "dark");
      if (!storedTheme) {
        localStorage.setItem("app-theme", initialTheme);
      }
      const storedLang = localStorage.getItem("app-language");
      if (storedLang) {
        document.documentElement.setAttribute("lang", storedLang);
      }
    } catch (error) {
      console.warn("Préférences locales indisponibles :", error);
    }
  </script>
  <script>
    window.tailwind = window.tailwind || {};
    window.tailwind.config = {
      darkMode: "class",
    };
  </script>
  
  <script defer src="/static/js/preferences.js"></script>
  <link rel="shortcut icon" href="/static/ico/favicon.ico" type="image/x-icon">
</head>
<body class="min-h-screen bg-slate-100 text-slate-900 dark:bg-slate-950 dark:text-slate-100 flex flex-col transition-colors duration-300">
  {{ template "navbar" . }}
  <main class="flex-1 container mx-auto px-4 py-12">
    {{ $ctx := . }}
    {{ with .ContentTemplate }}
      {{ if eq . "home_content" }}
        {{ template "home_content" $ctx }}
      {{ else if eq . "expenses_content" }}
        {{ template "expenses_content" $ctx }}
      {{ else if eq . "create_expense_content" }}
        {{ template "create_expense_content" $ctx }}
      {{ else if eq . "login_content" }}
        {{ template "login_content" $ctx }}
      {{ else if eq . "register_content" }}
        {{ template "register_content" $ctx }}
      {{ else if eq . "admin_content" }}
        {{ template "admin_content" $ctx }}
      {{ end }}
    {{ end }}
  </main>
  {{ template "footer" . }}
</body>
</html>
{{- end }}
